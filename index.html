<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSVP System</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <!-- Guest Count Modal -->
    <div id="guest-count-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 max-w-sm mx-4">
            <div class="text-center mb-4">
                <h3 class="text-2xl font-bold text-blue-600">How many guests?</h3>
                <p class="text-gray-600 mt-2">Please let us know how many people will be attending</p>
            </div>
            
            <form id="guest-form" class="space-y-6">
                <div class="flex items-center justify-between">
                    <label class="text-lg font-medium text-gray-700">Adults:</label>
                    <div class="flex items-center">
                        <button type="button" class="decrement-btn bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold w-8 h-8 rounded-l-lg flex items-center justify-center">-</button>
                        <input type="number" id="adult-count" class="number-input h-8 text-center border-y border-gray-300" value="1" min="0" max="10">
                        <button type="button" class="increment-btn bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold w-8 h-8 rounded-r-lg flex items-center justify-center">+</button>
                    </div>
                </div>
                
                <div class="flex items-center justify-between">
                    <label class="text-lg font-medium text-gray-700">Children:</label>
                    <div class="flex items-center">
                        <button type="button" class="decrement-btn bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold w-8 h-8 rounded-l-lg flex items-center justify-center">-</button>
                        <input type="number" id="child-count" class="number-input h-8 text-center border-y border-gray-300" value="1" min="0" max="10">
                        <button type="button" class="increment-btn bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold w-8 h-8 rounded-r-lg flex items-center justify-center">+</button>
                    </div>
                </div>
                
                <div class="pt-2">
                    <label class="block text-lg font-medium text-gray-700 mb-2">Your Name:</label>
                    <input type="text" id="guest-name" class="w-full h-10 px-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                
                <div class="pt-2">
                    <label class="block text-lg font-medium text-gray-700 mb-2">Your Email or Phone:</label>
                    <input type="text" id="guest-contact" class="w-full h-10 px-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                
                <div class="pt-4">
                    <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg transition">
                        Confirm
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- RSVP Confirmation Modal -->
    <div id="rsvp-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-6 max-w-sm mx-4">
            <div id="rsvp-content" class="text-center">
                <!-- Content will be set by JavaScript -->
            </div>
            <div class="mt-6 text-center">
                <button id="close-modal" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="admin-panel" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-6 max-w-md mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-2xl font-bold text-gray-800">RSVP Responses</h3>
                <button id="close-admin" class="text-gray-500 hover:text-gray-700">
                    âœ•
                </button>
            </div>
            
            <div id="admin-content" class="space-y-4">
                <!-- RSVP data will be displayed here -->
                <p class="text-gray-600 text-center">No responses yet</p>
            </div>
            
            <div class="mt-6">
                <button id="export-data" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition">
                    Export Data (CSV)
                </button>
            </div>
        </div>
    </div>

    <!-- Admin Access Button -->
    <div class="fixed bottom-4 right-4">
        <button id="show-admin" class="bg-gray-700 hover:bg-gray-800 text-white rounded-full w-12 h-12 flex items-center justify-center shadow-lg">
            ðŸ‘‘
        </button>
    </div>

    <script>
        // Guest count form handling
        const guestForm = document.getElementById('guest-form');
        const adultCountInput = document.getElementById('adult-count');
        const childCountInput = document.getElementById('child-count');
        const guestNameInput = document.getElementById('guest-name');
        const guestContactInput = document.getElementById('guest-contact');
        const rsvpModal = document.getElementById('rsvp-modal');
        const rsvpContent = document.getElementById('rsvp-content');
        const closeModalButton = document.getElementById('close-modal');
        const adminPanel = document.getElementById('admin-panel');
        const showAdminButton = document.getElementById('show-admin');
        const closeAdminButton = document.getElementById('close-admin');
        const adminContent = document.getElementById('admin-content');
        const exportButton = document.getElementById('export-data');

        // Increment/decrement buttons
        document.querySelectorAll('.increment-btn').forEach(button => {
            button.addEventListener('click', () => {
                const input = button.previousElementSibling;
                const currentValue = parseInt(input.value);
                if (currentValue < parseInt(input.max)) {
                    input.value = currentValue + 1;
                }
            });
        });
        
        document.querySelectorAll('.decrement-btn').forEach(button => {
            button.addEventListener('click', () => {
                const input = button.nextElementSibling;
                const currentValue = parseInt(input.value);
                if (currentValue > parseInt(input.min)) {
                    input.value = currentValue - 1;
                }
            });
        });

        // Form submission
        guestForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const adultCount = parseInt(adultCountInput.value);
            const childCount = parseInt(childCountInput.value);
            const guestName = guestNameInput.value;
            const guestContact = guestContactInput.value;
            
            // Save the RSVP data
            saveRSVP(guestName, guestContact, adultCount, childCount, true);
            
            // Show confirmation with guest count
            rsvpContent.innerHTML = `
                <h3 class="text-2xl font-bold text-green-600 mb-2">Thank You!</h3>
                <p class="text-gray-700">We've received your RSVP for:</p>
                <div class="bg-blue-50 rounded-lg p-3 my-3">
                    <p>${adultCount} adult${adultCount !== 1 ? 's' : ''}</p>
                    <p>${childCount} child${childCount !== 1 ? 'ren' : ''}</p>
                </div>
                <p class="text-gray-700">We look forward to seeing you!</p>
            `;
            rsvpModal.classList.remove('hidden');
        });

        // RSVP data storage
        function saveRSVP(name, contact, adults, children, attending) {
            // Get existing RSVPs from localStorage
            let rsvps = JSON.parse(localStorage.getItem('eventRSVPs') || '[]');
            
            // Add new RSVP
            const newRSVP = {
                name,
                contact,
                adults,
                children,
                attending,
                timestamp: new Date().toISOString()
            };
            
            rsvps.push(newRSVP);
            
            // Save back to localStorage
            localStorage.setItem('eventRSVPs', JSON.stringify(rsvps));
            
            // Update admin panel if open
            updateAdminPanel();
        }

        // Admin panel functions
        showAdminButton.addEventListener('click', () => {
            updateAdminPanel();
            adminPanel.classList.remove('hidden');
        });

        closeAdminButton.addEventListener('click', () => {
            adminPanel.classList.add('hidden');
        });

        closeModalButton.addEventListener('click', () => {
            rsvpModal.classList.add('hidden');
        });

        function updateAdminPanel() {
            const rsvps = JSON.parse(localStorage.getItem('eventRSVPs') || '[]');
            
            if (rsvps.length === 0) {
                adminContent.innerHTML = '<p class="text-gray-600 text-center">No responses yet</p>';
                return;
            }
            
            // Count totals
            let totalAttending = 0;
            let totalAdults = 0;
            let totalChildren = 0;
            
            rsvps.forEach(rsvp => {
                if (rsvp.attending) {
                    totalAttending++;
                    totalAdults += rsvp.adults;
                    totalChildren += rsvp.children;
                }
            });
            
            // Create summary
            let html = `
                <div class="bg-blue-50 p-4 rounded-lg mb-6">
                    <h4 class="font-bold text-lg text-blue-800 mb-2">Summary</h4>
                    <p><span class="font-medium">Total Responses:</span> ${rsvps.length}</p>
                    <p><span class="font-medium">Attending:</span> ${totalAttending}</p>
                    <p><span class="font-medium">Total Adults:</span> ${totalAdults}</p>
                    <p><span class="font-medium">Total Children:</span> ${totalChildren}</p>
                </div>
                <h4 class="font-bold text-lg mb-3">All Responses</h4>
            `;
            
            // Add individual responses
            rsvps.forEach((rsvp, index) => {
                const date = new Date(rsvp.timestamp).toLocaleDateString();
                html += `
                    <div class="border border-gray-200 rounded-lg p-3 ${rsvp.attending ? 'bg-green-50' : 'bg-gray-50'}">
                        <div class="flex justify-between">
                            <p class="font-medium">${rsvp.name}</p>
                            <span class="text-sm text-gray-500">${date}</span>
                        </div>
                        <p>${rsvp.contact}</p>
                        <p class="mt-1">${rsvp.attending ? 
                            `Attending: ${rsvp.adults} adults, ${rsvp.children} children` : 
                            'Not attending'}
                        </p>
                    </div>
                `;
            });
            
            adminContent.innerHTML = html;
        }

        // Export data
        exportButton.addEventListener('click', () => {
            const rsvps = JSON.parse(localStorage.getItem('eventRSVPs') || '[]');
            
            if (rsvps.length === 0) {
                alert('No data to export');
                return;
            }
            
            // Create CSV content
            let csvContent = 'Name,Contact,Attending,Adults,Children,Timestamp\n';
            
            rsvps.forEach(rsvp => {
                const row = [
                    `"${rsvp.name}"`,
                    `"${rsvp.contact}"`,
                    rsvp.attending ? 'Yes' : 'No',
                    rsvp.adults || 0,
                    rsvp.children || 0,
                    rsvp.timestamp
                ];
                csvContent += row.join(',') + '\n';
            });
            
            // Create download link
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.setAttribute('href', url);
            a.setAttribute('download', 'event_rsvps.csv');
            a.click();
        });

        // Initialize
        updateAdminPanel();
    </script>
</body>
</html>
